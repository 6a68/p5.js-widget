{"version":3,"sources":["webpack:///p5-widget.js","webpack:///webpack/bootstrap 025d8f58d15d8911737d","webpack:///./lib/p5-widget.ts","webpack:///./lib/defaults.ts"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","getMyBaseURL","url","slice","MY_FILENAME","length","getMyScriptEl","document","currentScript","querySelectorAll","isElementInViewport","el","rect","getBoundingClientRect","bottom","right","top","window","innerHeight","documentElement","clientHeight","left","innerWidth","clientWidth","getDataHeight","height","parseInt","getAttribute","isNaN","defaults","HEIGHT","replaceScriptWithWidget","iframe","createElement","previewWidth","p5version","autoplay","hasAttribute","qsArgs","encodeURIComponent","textContent","style","IFRAME_STYLE","push","myBaseURL","IFRAME_FILENAME","join","setAttribute","parentNode","replaceChild","whenVisible","cb","maybeMakeVisible","clearInterval","interval","removeEventListener","setInterval","addEventListener","lazilyReplaceAllScriptsWithWidget","scripts","forEach","display","fontSize","width","minHeight","background","myScriptEl","src","autoload","readyState","baseURL","replaceScript","replaceAll","P5_VERSION","PREVIEW_WIDTH"],"mappings":"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","file":"p5-widget.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar defaults = __webpack_require__(1);\r\n\tvar MY_FILENAME = 'p5-widget.js';\r\n\tvar IFRAME_FILENAME = 'p5-widget.html';\r\n\tvar IFRAME_STYLE = [\r\n\t    'width: 100%',\r\n\t    'border: 1px solid #ec245e',\r\n\t    'box-sizing: border-box'\r\n\t];\r\n\tvar myScriptEl = getMyScriptEl();\r\n\tvar myBaseURL = getMyBaseURL(myScriptEl.src);\r\n\tvar autoload = !myScriptEl.hasAttribute('data-manual');\r\n\tfunction getMyBaseURL(url) {\r\n\t    return url.slice(0, -MY_FILENAME.length);\r\n\t}\r\n\tfunction getMyScriptEl() {\r\n\t    return (document.currentScript ||\r\n\t        document.querySelectorAll(\"script[src$='\" + MY_FILENAME + \"']\")[0]);\r\n\t}\r\n\t// http://stackoverflow.com/a/7557433/2422398\r\n\tfunction isElementInViewport(el) {\r\n\t    var rect = el.getBoundingClientRect();\r\n\t    return (rect.bottom >= 0 &&\r\n\t        rect.right >= 0 &&\r\n\t        rect.top <= (window.innerHeight ||\r\n\t            document.documentElement.clientHeight) &&\r\n\t        rect.left <= (window.innerWidth ||\r\n\t            document.documentElement.clientWidth));\r\n\t}\r\n\tfunction getDataHeight(el) {\r\n\t    var height = parseInt(el.getAttribute('data-height'));\r\n\t    if (isNaN(height))\r\n\t        height = defaults.HEIGHT;\r\n\t    return height;\r\n\t}\r\n\tfunction replaceScriptWithWidget(el) {\r\n\t    var iframe = document.createElement('iframe');\r\n\t    var height = getDataHeight(el);\r\n\t    var previewWidth = parseInt(el.getAttribute('data-preview-width'));\r\n\t    var p5version = el.getAttribute('data-p5-version');\r\n\t    var autoplay = el.hasAttribute('data-autoplay');\r\n\t    var url;\r\n\t    var qsArgs = ['sketch=' + encodeURIComponent(el.textContent)];\r\n\t    var style = IFRAME_STYLE.slice();\r\n\t    if (!isNaN(previewWidth) && previewWidth >= 0) {\r\n\t        qsArgs.push('previewWidth=' + previewWidth);\r\n\t    }\r\n\t    if (p5version) {\r\n\t        qsArgs.push('p5version=' + encodeURIComponent(p5version));\r\n\t    }\r\n\t    if (autoplay) {\r\n\t        qsArgs.push('autoplay=on');\r\n\t    }\r\n\t    style.push('min-height: ' + height + 'px');\r\n\t    url = myBaseURL + IFRAME_FILENAME + '?' + qsArgs.join('&');\r\n\t    iframe.setAttribute('src', url);\r\n\t    iframe.setAttribute('style', style.join('; '));\r\n\t    el.parentNode.replaceChild(iframe, el);\r\n\t}\r\n\tfunction whenVisible(el, cb) {\r\n\t    var CHECK_INTERVAL_MS = 1000;\r\n\t    var interval;\r\n\t    function maybeMakeVisible() {\r\n\t        if (!isElementInViewport(el))\r\n\t            return;\r\n\t        clearInterval(interval);\r\n\t        window.removeEventListener('scroll', maybeMakeVisible, false);\r\n\t        window.removeEventListener('resize', maybeMakeVisible, false);\r\n\t        cb(el);\r\n\t    }\r\n\t    // We want to check at a fixed interval as a fallback, to make\r\n\t    // sure that we detect when the element is visible even outside\r\n\t    // of the usual means (e.g., because the user did some\r\n\t    // sort of pinch/zoom gesture).\r\n\t    interval = setInterval(maybeMakeVisible, 1000);\r\n\t    window.addEventListener('scroll', maybeMakeVisible, false);\r\n\t    window.addEventListener('resize', maybeMakeVisible, false);\r\n\t    maybeMakeVisible();\r\n\t}\r\n\tfunction lazilyReplaceAllScriptsWithWidget() {\r\n\t    var scripts = document.querySelectorAll(\"script[type='text/p5']\");\r\n\t    [].slice.call(scripts).forEach(function (el) {\r\n\t        var height = getDataHeight(el);\r\n\t        el.style.display = 'block';\r\n\t        el.style.fontSize = '0';\r\n\t        el.style.width = '100%';\r\n\t        el.style.minHeight = height + 'px';\r\n\t        el.style.background = '#f0f0f0';\r\n\t        whenVisible(el, replaceScriptWithWidget);\r\n\t    });\r\n\t}\r\n\tif (autoload) {\r\n\t    if (document.readyState === 'complete') {\r\n\t        lazilyReplaceAllScriptsWithWidget();\r\n\t    }\r\n\t    else {\r\n\t        window.addEventListener('load', lazilyReplaceAllScriptsWithWidget, false);\r\n\t    }\r\n\t}\r\n\twindow['p5Widget'] = {\r\n\t    baseURL: myBaseURL,\r\n\t    url: myBaseURL + MY_FILENAME,\r\n\t    replaceScript: replaceScriptWithWidget,\r\n\t    replaceAll: lazilyReplaceAllScriptsWithWidget,\r\n\t    defaults: defaults\r\n\t};\r\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\r\n\texports.P5_VERSION = '0.4.23';\r\n\texports.PREVIEW_WIDTH = 150;\r\n\texports.HEIGHT = 300;\r\n\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** p5-widget.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 025d8f58d15d8911737d\n **/","import * as defaults from \"./defaults\";\r\n\r\nconst MY_FILENAME = 'p5-widget.js';\r\nconst IFRAME_FILENAME = 'p5-widget.html';\r\nconst IFRAME_STYLE = [\r\n  'width: 100%',\r\n  'border: 1px solid #ec245e',\r\n  'box-sizing: border-box'\r\n];\r\n\r\nlet myScriptEl = getMyScriptEl() as HTMLScriptElement;\r\nlet myBaseURL = getMyBaseURL(myScriptEl.src);\r\nlet autoload = !myScriptEl.hasAttribute('data-manual');\r\n\r\nfunction getMyBaseURL(url: string) {\r\n  return url.slice(0, -MY_FILENAME.length);\r\n}\r\n\r\nfunction getMyScriptEl() {\r\n  return (\r\n    document.currentScript ||\r\n    document.querySelectorAll(\"script[src$='\" + MY_FILENAME + \"']\")[0]\r\n  );\r\n}\r\n\r\n// http://stackoverflow.com/a/7557433/2422398\r\nfunction isElementInViewport(el: HTMLElement) {\r\n  var rect = el.getBoundingClientRect();\r\n\r\n  return (\r\n    rect.bottom >= 0 &&\r\n    rect.right >= 0 &&\r\n    rect.top <= (window.innerHeight ||\r\n                 document.documentElement.clientHeight) &&\r\n    rect.left <= (window.innerWidth ||\r\n                  document.documentElement.clientWidth)\r\n  );\r\n}\r\n\r\nfunction getDataHeight(el: HTMLScriptElement) {\r\n  let height = parseInt(el.getAttribute('data-height'));\r\n\r\n  if (isNaN(height)) height = defaults.HEIGHT;\r\n\r\n  return height;\r\n}\r\n\r\nfunction replaceScriptWithWidget(el: HTMLScriptElement) {\r\n  let iframe = document.createElement('iframe');\r\n  let height = getDataHeight(el);\r\n  let previewWidth = parseInt(el.getAttribute('data-preview-width'));\r\n  let p5version = el.getAttribute('data-p5-version');\r\n  let autoplay = el.hasAttribute('data-autoplay');\r\n  let url;\r\n  let qsArgs = ['sketch=' + encodeURIComponent(el.textContent)];\r\n  let style = IFRAME_STYLE.slice();\r\n\r\n  if (!isNaN(previewWidth) && previewWidth >= 0) {\r\n    qsArgs.push('previewWidth=' + previewWidth);\r\n  }\r\n\r\n  if (p5version) {\r\n    qsArgs.push('p5version=' + encodeURIComponent(p5version));\r\n  }\r\n\r\n  if (autoplay) {\r\n    qsArgs.push('autoplay=on');\r\n  }\r\n\r\n  style.push('min-height: ' + height + 'px');\r\n  url = myBaseURL + IFRAME_FILENAME + '?' + qsArgs.join('&');\r\n  iframe.setAttribute('src', url);\r\n  iframe.setAttribute('style', style.join('; '));\r\n\r\n  el.parentNode.replaceChild(iframe, el);\r\n}\r\n\r\nfunction whenVisible(el: HTMLScriptElement,\r\n                     cb: (el: HTMLScriptElement) => void) {\r\n  let CHECK_INTERVAL_MS = 1000;\r\n  let interval: number;\r\n\r\n  function maybeMakeVisible() {\r\n    if (!isElementInViewport(el)) return;\r\n\r\n    clearInterval(interval);\r\n    window.removeEventListener('scroll', maybeMakeVisible, false);\r\n    window.removeEventListener('resize', maybeMakeVisible, false);\r\n    cb(el);\r\n  }\r\n\r\n  // We want to check at a fixed interval as a fallback, to make\r\n  // sure that we detect when the element is visible even outside\r\n  // of the usual means (e.g., because the user did some\r\n  // sort of pinch/zoom gesture).\r\n  interval = setInterval(maybeMakeVisible, 1000);\r\n\r\n  window.addEventListener('scroll', maybeMakeVisible, false);\r\n  window.addEventListener('resize', maybeMakeVisible, false);\r\n  maybeMakeVisible();\r\n}\r\n\r\nfunction lazilyReplaceAllScriptsWithWidget() {\r\n  let scripts = document.querySelectorAll(\"script[type='text/p5']\");\r\n\r\n  [].slice.call(scripts).forEach((el: HTMLScriptElement) => {\r\n    let height = getDataHeight(el);\r\n\r\n    el.style.display = 'block';\r\n    el.style.fontSize = '0';\r\n    el.style.width = '100%';\r\n    el.style.minHeight = height + 'px';\r\n    el.style.background = '#f0f0f0';\r\n\r\n    whenVisible(el, replaceScriptWithWidget);\r\n  });\r\n}\r\n\r\nif (autoload) {\r\n  if (document.readyState === 'complete') {\r\n    lazilyReplaceAllScriptsWithWidget();\r\n  } else {\r\n    window.addEventListener(\r\n      'load',\r\n      lazilyReplaceAllScriptsWithWidget,\r\n      false\r\n    );\r\n  }\r\n}\r\n\r\nwindow['p5Widget'] = {\r\n  baseURL: myBaseURL,\r\n  url: myBaseURL + MY_FILENAME,\r\n  replaceScript: replaceScriptWithWidget,\r\n  replaceAll: lazilyReplaceAllScriptsWithWidget,\r\n  defaults: defaults\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/p5-widget.ts\n **/","export const P5_VERSION = '0.4.23';\nexport const PREVIEW_WIDTH = 150;\nexport const HEIGHT = 300;\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/defaults.ts\n **/"],"sourceRoot":""}